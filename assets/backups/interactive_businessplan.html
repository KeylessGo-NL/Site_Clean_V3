<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KeylessGo Strategisch Plan 2025-2035</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F8FAFC; color: #0F172A; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #94A3B8; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748B; }

        /* Chart Wrapper */
        .chart-wrapper {
            position: relative;
            width: 100%;
            max-width: 1000px;
            height: 400px;
            margin: 0 auto;
        }
        @media (max-width: 768px) {
            .chart-wrapper { height: 300px; }
        }

        .nav-link {
            position: relative;
            cursor: pointer;
        }
        .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -4px;
            left: 0;
            background-color: #0EA5E9;
            transition: width 0.3s;
        }
        .nav-link:hover::after { width: 100%; }

        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); }

        .risk-card { transition: all 0.2s ease; border-left: 4px solid transparent; }
        .risk-card:hover { border-left-color: #0EA5E9; background-color: #F1F5F9; }

        /* Slider Styling */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #0EA5E9;
            cursor: pointer;
            margin-top: -8px; 
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #CBD5E1;
            border-radius: 2px;
        }
        
        /* Table Styles */
        .sim-table td { padding: 4px 0; border-bottom: 1px solid rgba(255,255,255,0.1); font-size: 0.85rem; }
        .sim-table tr:last-child td { border-bottom: none; }
        .sim-table .amount { text-align: right; font-family: monospace; }

        /* Forecast Table */
        .forecast-table th { background-color: #F1F5F9; color: #475569; font-weight: 600; font-size: 0.75rem; text-transform: uppercase; padding: 12px 8px; text-align: right; }
        .forecast-table th:first-child { text-align: left; }
        .forecast-table td { border-bottom: 1px solid #E2E8F0; padding: 10px 8px; text-align: right; font-family: monospace; font-size: 0.9rem; color: #334155; }
        .forecast-table td:first-child { text-align: left; font-family: 'Inter', sans-serif; font-weight: 500; color: #0F172A; }
        .forecast-table tr:hover { background-color: #F8FAFC; }
        .forecast-table .total-row td { background-color: #F8FAFC; font-weight: 700; border-top: 2px solid #CBD5E1; color: #0F172A; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Navigation -->
    <nav class="bg-slate-900 text-white sticky top-0 z-50 shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center space-x-2 cursor-pointer" onclick="window.scrollTo(0,0)">
                    <span class="text-2xl">üöó</span>
                    <span class="font-bold text-xl tracking-wider">KEYLESS<span class="text-sky-400">GO</span></span>
                </div>
                <div class="hidden lg:flex space-x-4 text-sm font-medium">
                    <a onclick="scrollToSection('market')" class="nav-link text-slate-300 hover:text-white">Markt</a>
                    <a onclick="scrollToSection('fleet')" class="nav-link text-slate-300 hover:text-white">Strategie</a>
                    <a onclick="scrollToSection('simulation')" class="nav-link text-sky-400 hover:text-sky-300">Simulator & Forecast</a>
                    <a onclick="scrollToSection('investor')" class="nav-link text-slate-300 hover:text-white">Investering</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="bg-white border-b border-slate-200">
        <div class="max-w-7xl mx-auto px-4 py-16 sm:px-6 lg:px-8 text-center">
            <div class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-sky-100 text-sky-800 mb-6">
                üöÄ Startdatum: December 2025
            </div>
            <h1 class="text-4xl font-extrabold text-slate-900 sm:text-5xl lg:text-6xl mb-6">
                Strategische Vlootoptimalisatie <span class="text-transparent bg-clip-text bg-gradient-to-r from-sky-500 to-blue-600">Provincie Utrecht</span>
            </h1>
            <p class="mt-4 text-xl text-slate-600 max-w-3xl mx-auto">
                Asset-Backed Expansie in de 'Tweede Auto' Markt. Een datagedreven model gericht op Vinex-locaties, lichte bedrijfswagens en de transitie naar MaaS.
            </p>
        </div>
    </header>

    <!-- Section 1: Market Context & Location Intelligence -->
    <section id="market" class="py-16 bg-slate-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-slate-900">Macro-Context: De Vinex-Paradox & MaaS</h2>
                <p class="mt-4 text-lg text-slate-600">
                    Wij exploiteren de frictie tussen stijgende parkeerdruk en de behoefte aan incidenteel transportvermogen.
                </p>
            </div>
            <!-- ... (Content preserved but minimized for brevity in this update to focus on logic) ... -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                    <div class="text-4xl mb-4">üéØ</div>
                    <h3 class="font-bold text-slate-900">PC4 Hotspots</h3>
                    <p class="text-sm text-slate-600 mt-2">Leidsche Rijn, Houten, Zeist. Hoge inkomens, hoge parkeerdruk.</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                    <div class="text-4xl mb-4">üöê</div>
                    <h3 class="font-bold text-slate-900">LCV Niche</h3>
                    <p class="text-sm text-slate-600 mt-2">Geen deelscooters, maar 'Heavy Lifting'. Verhuizen, klussen, vakantie.</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                    <div class="text-4xl mb-4">‚ôªÔ∏è</div>
                    <h3 class="font-bold text-slate-900">Euro 6+ Strategie</h3>
                    <p class="text-sm text-slate-600 mt-2">Toegang tot milieuzones gegarandeerd tot 2028+. Waardevaste assets.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Section 2: Fleet Strategy (Unit Economics) -->
    <section id="fleet" class="py-16 bg-white border-y border-slate-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-10">
                <h2 class="text-3xl font-bold text-slate-900">De High-Yield Vlootmix (70/30)</h2>
                <p class="mt-4 text-lg text-slate-600">
                    Lichte bedrijfswagens genereren tot <strong>4.8x</strong> meer winst dan compacte auto's.
                </p>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
                 <!-- Unit Economics Card -->
                 <div class="bg-slate-50 p-6 rounded-2xl border border-slate-200">
                    <h3 class="font-bold text-lg mb-4 text-center">Vergelijkend Winstmodel (Maandbasis)</h3>
                    <div class="flex justify-between border-b pb-2 mb-2 font-bold text-slate-400 text-xs uppercase">
                        <span>Metric</span>
                        <span>Auto</span>
                        <span>Bus (Transporter)</span>
                    </div>
                    <div class="flex justify-between border-b pb-2 mb-2 text-sm">
                        <span class="text-slate-600">Omzet</span>
                        <span>‚Ç¨ 550</span>
                        <span class="font-bold">‚Ç¨ 1.357</span>
                    </div>
                    <div class="flex justify-between border-b pb-2 mb-2 text-sm">
                        <span class="text-slate-600">Netto (na fee)</span>
                        <span>‚Ç¨ 385</span>
                        <span class="font-bold">‚Ç¨ 950</span>
                    </div>
                    <div class="flex justify-between pt-2 text-sm font-bold">
                        <span class="text-slate-900">Winst</span>
                        <span class="text-yellow-600">‚Ç¨ 67</span>
                        <span class="text-green-600 text-lg">‚Ç¨ 322</span>
                    </div>
                </div>
                <div class="text-slate-600 space-y-4">
                    <p><strong>De Bus (70%):</strong> De financi√´le motor. Hoge dagwaarde, lange ritten, minder concurrentie.</p>
                    <p><strong>De Auto (30%):</strong> Service product. Zorgt voor zichtbaarheid in de wijk en verhoogt de frequentie van gebruik.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- INTEGRATED SIMULATOR & FORECAST SECTION -->
    <section id="simulation" class="py-16 bg-slate-900 text-white relative overflow-hidden">
        <!-- Decoration -->
        <div class="absolute top-0 right-0 -mr-20 -mt-20 w-96 h-96 rounded-full bg-sky-500 opacity-10 blur-3xl"></div>
        <div class="absolute bottom-0 left-0 -ml-20 -mb-20 w-96 h-96 rounded-full bg-purple-500 opacity-10 blur-3xl"></div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="mb-8 text-center">
                <div class="inline-block bg-sky-600 text-white text-xs font-bold px-3 py-1 rounded-full mb-4">INTEGRAAL MODEL v3.0</div>
                <h2 class="text-3xl font-bold">Scenario Simulator & Real-Time Prognose</h2>
                <p class="mt-4 text-slate-400 max-w-2xl mx-auto">
                    Pas de drivers aan in de linkerkolom. Het model berekent direct de impact op de maandwinst √©n de 10-jarenprognose.
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
                
                <!-- INPUTS (Left) -->
                <div class="lg:col-span-4 bg-slate-800 p-6 rounded-2xl border border-slate-700 shadow-xl space-y-6 h-fit sticky top-24">
                    <div class="flex items-center justify-between border-b border-slate-700 pb-2 mb-4">
                        <h3 class="text-lg font-bold text-white flex items-center"><span class="mr-2">üéõÔ∏è</span> Scenario Drivers</h3>
                        <button onclick="resetSimulation()" class="text-xs text-sky-400 hover:text-white underline">Reset</button>
                    </div>

                    <!-- Fleet Config -->
                    <div>
                        <div class="flex justify-between mb-1">
                            <label class="text-xs font-bold text-slate-400 uppercase">Start Vlootgrootte</label>
                            <span id="sim-size-val" class="text-sky-400 text-xs font-bold">10</span>
                        </div>
                        <input type="range" id="sim-size" min="5" max="50" value="10" step="1" class="w-full mb-4" oninput="runSimulation()">
                        
                        <div class="flex justify-between mb-1">
                            <label class="text-xs font-medium text-slate-300">Mix: Bus vs Auto</label>
                            <span id="sim-mix-val" class="text-sky-400 text-xs font-bold">70% Bus</span>
                        </div>
                        <input type="range" id="sim-mix" min="0" max="100" value="70" step="10" class="w-full" oninput="runSimulation()">
                    </div>

                    <!-- Performance -->
                    <div class="pt-4 border-t border-slate-700">
                        <label class="text-xs font-bold text-slate-400 uppercase mb-3 block">Pricing & Performance</label>
                        
                        <div class="flex justify-between mb-1">
                            <label class="text-xs font-medium text-slate-300">Bezettingsgraad</label>
                            <span id="sim-occ-val" class="text-sky-400 text-xs font-bold">35%</span>
                        </div>
                        <input type="range" id="sim-occ" min="15" max="65" value="35" step="1" class="w-full mb-4" oninput="runSimulation()">

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-xs font-medium text-slate-300 block mb-1">Prijs Bus (‚Ç¨)</label>
                                <input type="number" id="sim-price-bus" value="85" class="w-full bg-slate-900 border border-slate-600 rounded px-2 py-1 text-sm text-white focus:border-sky-500 outline-none" oninput="runSimulation()">
                            </div>
                            <div>
                                <label class="text-xs font-medium text-slate-300 block mb-1">Prijs Auto (‚Ç¨)</label>
                                <input type="number" id="sim-price-car" value="45" class="w-full bg-slate-900 border border-slate-600 rounded px-2 py-1 text-sm text-white focus:border-sky-500 outline-none" oninput="runSimulation()">
                            </div>
                        </div>
                    </div>

                    <!-- Costs -->
                    <div class="pt-4 border-t border-slate-700">
                        <label class="text-xs font-bold text-slate-400 uppercase mb-3 block">Risico & Buffer</label>
                        <div class="flex justify-between mb-1">
                            <label class="text-xs font-medium text-slate-300">Onvoorzien (% Omzet)</label>
                            <span id="sim-buffer-val" class="text-yellow-400 text-xs font-bold">5%</span>
                        </div>
                        <input type="range" id="sim-buffer" min="0" max="15" value="5" step="1" class="w-full" oninput="runSimulation()">
                    </div>
                </div>

                <!-- OUTPUTS (Right) -->
                <div class="lg:col-span-8 space-y-8">
                    
                    <!-- 1. SNAPSHOT (Single Month) -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-white rounded-xl p-5 shadow-lg text-slate-900 relative overflow-hidden">
                            <div class="absolute top-0 right-0 w-20 h-20 bg-green-100 rounded-bl-full -mr-2 -mt-2 z-0"></div>
                            <h4 class="text-xs font-bold uppercase text-slate-500 relative z-10">Huidige Maandwinst</h4>
                            <div class="mt-2 text-4xl font-extrabold text-slate-900 relative z-10" id="res-profit">‚Ç¨ 2.340</div>
                            <div class="mt-2 text-xs font-bold px-2 py-0.5 rounded w-max relative z-10" id="res-profit-status">Winstgevend</div>
                            <div class="mt-4 pt-4 border-t border-slate-100 flex justify-between text-sm relative z-10">
                                <span class="text-slate-500">Omzet (Bruto):</span>
                                <span class="font-bold" id="res-gross">‚Ç¨ 12.000</span>
                            </div>
                        </div>

                        <div class="bg-slate-800 rounded-xl p-5 shadow-lg border border-slate-700 flex flex-col justify-between">
                            <div>
                                <h4 class="text-xs font-bold uppercase text-slate-400">Break-Even Point</h4>
                                <div class="mt-2 text-3xl font-extrabold text-white" id="res-breakeven">29%</div>
                                <div class="mt-2 w-full bg-slate-700 h-2 rounded-full overflow-hidden">
                                    <div id="res-breakeven-bar" class="bg-sky-500 h-full transition-all duration-300" style="width: 80%"></div>
                                </div>
                                <p class="text-xs text-slate-400 mt-1" id="res-breakeven-msg">U zit veilig boven break-even.</p>
                            </div>
                            <div class="mt-4 pt-4 border-t border-slate-600 flex justify-between text-xs">
                                <span class="text-slate-400">Startkapitaal ROI (Jaar 1):</span>
                                <span class="font-bold text-sky-400" id="res-roi">18.5%</span>
                            </div>
                        </div>
                    </div>

                    <!-- 2. FORECAST VISUALIZATION (Linked to inputs) -->
                    <div class="bg-white rounded-xl p-6 shadow-sm border border-slate-200">
                        <h3 class="font-bold text-slate-800 mb-4 flex justify-between items-center">
                            <span>10-Jaren Prognose (Dynamisch)</span>
                            <span class="text-xs font-normal text-slate-500 bg-slate-100 px-2 py-1 rounded">Incl. J-Curve Effect</span>
                        </h3>
                        <div class="chart-wrapper" style="height: 300px;">
                            <canvas id="forecastChart"></canvas>
                        </div>
                    </div>

                    <!-- 3. DETAILED TABLE -->
                    <div class="bg-slate-800 rounded-xl p-5 border border-slate-700 shadow-xl overflow-x-auto">
                        <table class="w-full text-slate-300 sim-table" id="forecast-table-el">
                            <thead>
                                <tr>
                                    <th class="text-left py-2 text-xs uppercase text-slate-500">Jaar</th>
                                    <th class="text-right py-2 text-xs uppercase text-slate-500">Vloot</th>
                                    <th class="text-right py-2 text-xs uppercase text-slate-500">Omzet</th>
                                    <th class="text-right py-2 text-xs uppercase text-slate-500">Kosten</th>
                                    <th class="text-right py-2 text-xs uppercase text-slate-500">Winst</th>
                                    <th class="text-right py-2 text-xs uppercase text-slate-500">Cumulatief</th>
                                </tr>
                            </thead>
                            <tbody class="text-sm font-mono">
                                <!-- JS Populates this -->
                            </tbody>
                        </table>
                    </div>

                </div>
            </div>
        </div>
    </section>

    <!-- Section: Investor Proposition & Risks -->
    <section id="investor" class="py-16 bg-white border-t border-slate-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-16">
                <!-- Investor Value Prop -->
                <div>
                    <h2 class="text-3xl font-bold text-slate-900 mb-6">Investeringspropositie</h2>
                    <p class="text-slate-600 mb-8">
                        Voor investeerders (Family, Friends & Fools) biedt KeylessGo een tastbaar alternatief voor volatiele aandelen of crypto. Wij noemen het: <em>"Stenen en Cement, maar dan op Wielen"</em>.
                    </p>
                    <div class="space-y-6">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <div class="flex items-center justify-center h-12 w-12 rounded-md bg-sky-500 text-white text-xl">üõ°</div>
                            </div>
                            <div class="ml-4">
                                <h4 class="text-lg font-bold text-slate-900">Asset-Backed Zekerheid</h4>
                                <p class="mt-1 text-slate-600 text-sm">
                                    Uw inleg is gedekt door fysieke voertuigen. Lichte bedrijfswagens kennen een hoge historische restwaarde (30-40% na 5 jaar).
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Risk Mitigation Matrix -->
                <div>
                    <h2 class="text-3xl font-bold text-slate-900 mb-6">Risico Analyse</h2>
                    <div class="space-y-3">
                        <div class="risk-card bg-slate-50 p-4 rounded-lg">
                            <h5 class="font-bold text-slate-800 text-sm">üõë Strategisch: Platform Afhankelijkheid</h5>
                            <p class="text-xs text-slate-600 mt-1">Mitigatie: Vloot is eigendom KeylessGo. In Fase 3 (>50 auto's) transitie naar hybride model/eigen platform.</p>
                        </div>
                        <div class="risk-card bg-slate-50 p-4 rounded-lg">
                            <h5 class="font-bold text-slate-800 text-sm">üõë Financieel: Liquiditeit</h5>
                            <p class="text-xs text-slate-600 mt-1">Mitigatie: 60-maanden lease minimaliseert vaste lasten. Hotspot data-analyse voorkomt leegstand.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="bg-slate-900 border-t border-slate-800 py-12 text-white">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <h4 class="font-bold text-lg mb-2">KeylessGo Utrecht</h4>
            <p class="text-slate-500 text-sm">Integraal Business Model v3.0</p>
        </div>
    </footer>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- GLOBAL STATE ---
        let forecastChartInstance = null;
        
        // --- HELPER FUNCTIONS ---
        function scrollToSection(id) { document.getElementById(id).scrollIntoView({ behavior: 'smooth' }); }

        function resetSimulation() {
            document.getElementById('sim-size').value = 10;
            document.getElementById('sim-mix').value = 70;
            document.getElementById('sim-occ').value = 35;
            document.getElementById('sim-price-bus').value = 85;
            document.getElementById('sim-price-car').value = 45;
            document.getElementById('sim-buffer').value = 5;
            runSimulation();
        }

        function formatMoney(amount) {
            return new Intl.NumberFormat('nl-NL', { style: 'currency', currency: 'EUR', maximumFractionDigits: 0 }).format(amount);
        }

        // --- CORE LOGIC: SIMULATOR + DYNAMIC FORECAST ---
        function runSimulation() {
            // 1. GATHER INPUTS
            const startSize = parseInt(document.getElementById('sim-size').value);
            const mix = parseInt(document.getElementById('sim-mix').value); // % Bus
            const occ = parseInt(document.getElementById('sim-occ').value); // % Occupancy
            const priceBus = parseFloat(document.getElementById('sim-price-bus').value) || 85;
            const priceCar = parseFloat(document.getElementById('sim-price-car').value) || 45;
            const bufferPct = parseInt(document.getElementById('sim-buffer').value);

            // Update Labels
            document.getElementById('sim-size-val').innerText = startSize;
            document.getElementById('sim-mix-val').innerText = `${mix}% Bus`;
            document.getElementById('sim-occ-val').innerText = `${occ}%`;
            document.getElementById('sim-buffer-val').innerText = `${bufferPct}%`;

            // 2. CONSTANTS (Monthly)
            const daysInMonth = 30.5;
            const leaseBus = 450;
            const leaseCar = 255;
            const fixedOpsBus = 30 + 18; // Ins + HW
            const fixedOpsCar = 20 + 18;
            const varOpsBusBase = 80; 
            const varOpsCarBase = 60;
            
            // 3. CALCULATE SNAPSHOT (Current Month based on Start Size)
            const numBuses = Math.round(startSize * (mix / 100));
            const numCars = startSize - numBuses;

            const revBus = numBuses * ((occ / 100) * daysInMonth) * priceBus;
            const revCar = numCars * ((occ / 100) * daysInMonth) * priceCar;
            const totalGross = revBus + revCar;

            const fee = totalGross * 0.30;
            const totalLease = (numBuses * leaseBus) + (numCars * leaseCar);
            const totalFixedOps = (numBuses * fixedOpsBus) + (numCars * fixedOpsCar);
            
            // Var ops scales slightly with occupancy
            const usageFactor = occ / 35; 
            const totalVarOps = ((numBuses * varOpsBusBase) + (numCars * varOpsCarBase)) * Math.max(0.8, usageFactor);
            const buffer = totalGross * (bufferPct / 100);

            const totalCosts = fee + totalLease + totalFixedOps + totalVarOps + buffer;
            const netProfit = totalGross - totalCosts;

            // 4. UPDATE SNAPSHOT UI
            document.getElementById('res-gross').innerText = formatMoney(totalGross);
            document.getElementById('res-profit').innerText = formatMoney(netProfit);
            
            const statusEl = document.getElementById('res-profit-status');
            if (netProfit > 0) {
                statusEl.innerText = "Winstgevend";
                statusEl.className = "mt-2 text-xs font-bold px-2 py-0.5 rounded w-max relative z-10 bg-green-100 text-green-700";
                document.getElementById('res-profit').className = "mt-2 text-4xl font-extrabold text-slate-900 relative z-10";
            } else {
                statusEl.innerText = "Verlieslatend";
                statusEl.className = "mt-2 text-xs font-bold px-2 py-0.5 rounded w-max relative z-10 bg-red-100 text-red-700";
                document.getElementById('res-profit').className = "mt-2 text-4xl font-extrabold text-red-600 relative z-10";
            }

            // Break-even
            const fixedTotal = totalLease + totalFixedOps;
            const varCostRatio = 0.30 + (bufferPct/100) + 0.10; // Approx var ratio
            const contributionMarginRatio = 1 - varCostRatio;
            const breakEvenRev = fixedTotal / contributionMarginRatio;
            const maxRev = (numBuses * daysInMonth * priceBus) + (numCars * daysInMonth * priceCar);
            let bePct = Math.round((breakEvenRev / maxRev) * 100);
            if(bePct > 100) bePct = 100; if(bePct < 0) bePct = 0;

            document.getElementById('res-breakeven').innerText = bePct + "%";
            document.getElementById('res-breakeven-bar').style.width = Math.min((occ/80)*100, 100) + "%";
            
            const safety = occ - bePct;
            const beMsg = document.getElementById('res-breakeven-msg');
            if(safety > 5) { beMsg.innerText = `Veilig (+${safety}%)`; beMsg.className="text-xs text-green-400 mt-1"; document.getElementById('res-breakeven-bar').className="bg-green-500 h-full transition-all"; }
            else if(safety >=0) { beMsg.innerText = `Kritiek (+${safety}%)`; beMsg.className="text-xs text-yellow-400 mt-1"; document.getElementById('res-breakeven-bar').className="bg-yellow-500 h-full transition-all"; }
            else { beMsg.innerText = `Onder Water (${safety}%)`; beMsg.className="text-xs text-red-400 mt-1"; document.getElementById('res-breakeven-bar').className="bg-red-500 h-full transition-all"; }

            // ROI
            const startCap = Math.max(100000, startSize * 5000);
            const roi = ((netProfit * 12) / startCap) * 100;
            document.getElementById('res-roi').innerText = roi.toFixed(1) + "%";


            // 5. GENERATE & RENDER DYNAMIC FORECAST (10 Years)
            generateForecast(startSize, mix, occ, priceBus, priceCar, bufferPct);
        }

        function generateForecast(startSize, mix, occ, pBus, pCar, bufPct) {
            const growthPattern = [1.0, 1.4, 1.8, 2.0, 2.2, 2.5, 2.8, 3.5, 3.8, 4.2]; // Relative growth factors
            const years = [];
            const dataFleet = [];
            const dataRev = [];
            const dataCost = [];
            const dataProfit = [];
            const dataCum = [];
            let runningCash = 0;
            
            let tableHTML = "";

            // J-Curve tracking: We need to know how many cars were added in which year to expire leases
            const fleetHistory = []; // Stores fleet size per year

            for(let i=0; i<10; i++) {
                const year = 2025 + i;
                const fleetSize = Math.round(startSize * growthPattern[i]);
                fleetHistory.push(fleetSize);

                const numBus = Math.round(fleetSize * (mix/100));
                const numCar = fleetSize - numBus;

                // J-Curve Logic: Lease is active for 5 years (Years 0-4 relative to acquisition)
                // Active Leases in Year i = Sum of (Fleet additions from i-4 to i)
                // Easier: ActiveLeaseCount = FleetSize[i] - FleetSize[i-5] (if i>=5)
                // This assumes retained fleet is fully paid off.
                
                let paidOffCount = 0;
                if(i >= 5) {
                    paidOffCount = fleetHistory[i-5]; // Vehicles from 5 years ago are now free
                }
                
                // Assuming paid off vehicles are kept in service (profit maximizers)
                // We need to split paidOffCount into Bus/Car ratio of THAT time, but let's approximate with current mix to keep it fast
                const activeLeaseTotal = Math.max(0, fleetSize - paidOffCount);
                const activeLeaseBus = Math.round(activeLeaseTotal * (mix/100));
                const activeLeaseCar = activeLeaseTotal - activeLeaseBus;

                // Monthly base for this year
                const days = 30.5;
                const mRev = (numBus * days * (occ/100) * pBus) + (numCar * days * (occ/100) * pCar);
                const mFee = mRev * 0.30;
                const mLease = (activeLeaseBus * 450) + (activeLeaseCar * 255);
                
                // Ops costs (Paid off vehicles still have ops costs!)
                // Ops increases slightly for older vehicles? Let's add 10% penalty for paid off ones
                const baseOps = ((numBus * 128) + (numCar * 98)); // Fixed+Var approx
                const agePenalty = paidOffCount * 30; // Extra maintenance for old cars
                const mOps = baseOps + agePenalty + (mRev * (bufPct/100));

                const mProfit = mRev - mFee - mLease - mOps;
                
                // Annualize
                const aRev = mRev * 12;
                const aCost = (mFee + mLease + mOps) * 12;
                const aProfit = mProfit * 12;
                runningCash += aProfit;

                // Store Data
                years.push(year);
                dataRev.push(aRev);
                dataCost.push(aCost);
                dataProfit.push(aProfit);
                dataCum.push(runningCash);

                // Table Row
                const profClass = aProfit >= 0 ? "text-green-400" : "text-red-400";
                tableHTML += `<tr>
                    <td class="text-left py-2 text-slate-400">${year}</td>
                    <td class="text-right py-2 text-slate-300">${fleetSize} <span class="text-xs text-slate-500">(${activeLeaseTotal} Lease)</span></td>
                    <td class="text-right py-2 text-slate-300">${formatMoney(aRev)}</td>
                    <td class="text-right py-2 text-red-400">- ${formatMoney(aCost)}</td>
                    <td class="text-right py-2 ${profClass} font-bold">${formatMoney(aProfit)}</td>
                    <td class="text-right py-2 text-sky-400 font-bold">${formatMoney(runningCash)}</td>
                </tr>`;
            }

            // RENDER TABLE
            document.querySelector('#forecast-table-el tbody').innerHTML = tableHTML;

            // RENDER CHART
            updateForecastChart(years, dataRev, dataCost, dataProfit);
        }

        function updateForecastChart(labels, rev, cost, profit) {
            const ctx = document.getElementById('forecastChart').getContext('2d');
            
            if (forecastChartInstance) {
                forecastChartInstance.destroy();
            }

            forecastChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        { label: 'Omzet', data: rev, backgroundColor: '#cbd5e1', order: 2 }, // Slate 300
                        { label: 'Totale Kosten', data: cost, backgroundColor: '#ef4444', order: 3 }, // Red
                        { type: 'line', label: 'Netto Winst', data: profit, borderColor: '#10b981', borderWidth: 3, pointBackgroundColor: '#0f172a', order: 1 } // Green Line
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { ticks: { callback: function(value) { return '‚Ç¨' + value / 1000 + 'k'; } } }
                    }
                }
            });
        }

        // --- INIT ---
        window.addEventListener('DOMContentLoaded', () => {
            runSimulation(); 
        });

    </script>
</body>
</html>